<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Downfall Tracker</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Nunito:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- CSS VARIABLES & THEME --- */
        :root {
            --font-heading: 'Fredoka', sans-serif;
            --font-body: 'Nunito', sans-serif;
            
            --bg-color: #f4f1ea;
            --card-bg: #ffffff;
            --text-main: #2d3436;
            --text-muted: #636e72;
            --accent-primary: #6c5ce7;
            --accent-secondary: #00cec9;
            --danger: #ff7675;
            --border-color: #2d3436;
            --shadow: 4px 4px 0px #2d3436;
            --input-bg: #dfe6e9;
            --chart-line: #6c5ce7;
            --chart-grid: #dfe6e9;
        }

        [data-theme="dark"] {
            --bg-color: #2d3436;
            --card-bg: #353b48;
            --text-main: #dfe6e9;
            --text-muted: #b2bec3;
            --accent-primary: #a29bfe;
            --accent-secondary: #81ecec;
            --danger: #fab1a0;
            --border-color: #000000;
            --shadow: 4px 4px 0px #000000;
            --input-bg: #2f3640;
            --chart-line: #a29bfe;
            --chart-grid: #636e72;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; transition: background-color 0.3s, color 0.3s; }
        body { font-family: var(--font-body); background-color: var(--bg-color); color: var(--text-main); display: flex; justify-content: center; min-height: 100vh; padding: 20px; }
        h1, h2, h3 { font-family: var(--font-heading); }
        button { cursor: pointer; font-family: var(--font-heading); border: 2px solid var(--border-color); outline: none; }

        /* --- APP CONTAINER --- */
        .app-container {
            width: 100%;
            max-width: 500px;
            display: none; 
            flex-direction: column;
            gap: 20px;
            animation: fadeIn 0.5s ease-out;
            padding-bottom: 20px;
        }

        /* --- ONBOARDING OVERLAY --- */
        .onboarding-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-color);
            z-index: 999;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .onboarding-card {
            background-color: var(--card-bg);
            border: 4px solid var(--border-color);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 8px 8px 0px var(--border-color);
            max-width: 400px;
            width: 100%;
            transform: rotate(1deg);
        }

        .onboarding-card h1 { font-size: 2rem; color: var(--accent-primary); margin-bottom: 10px; }
        .onboarding-card p { margin-bottom: 20px; font-size: 1.1rem; }

        /* --- HEADER & SCORE --- */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .title-block h1 { font-size: 1.8rem; color: var(--accent-primary); text-transform: uppercase; letter-spacing: 1px; text-shadow: 2px 2px 0px var(--border-color); }
        
        .theme-toggle { background: var(--card-bg); padding: 8px 12px; border-radius: 20px; font-weight: bold; box-shadow: 2px 2px 0px var(--border-color); color: var(--text-main); }
        .theme-toggle:active { transform: translate(2px, 2px); box-shadow: none; }

        .scoreboard-card {
            background-color: var(--card-bg);
            border: 3px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
            transform: rotate(-1deg);
        }
        .score-value { font-size: 4rem; font-family: var(--font-heading); color: var(--danger); line-height: 1; margin: 10px 0; }
        .score-sub { font-size: 0.9rem; font-style: italic; }

        /* --- CHART CARD --- */
        .chart-card {
            background-color: var(--card-bg);
            border: 3px solid var(--border-color);
            border-radius: 16px;
            padding: 15px;
            box-shadow: var(--shadow);
            transform: rotate(1deg);
            position: relative;
        }
        .chart-title { font-size: 1rem; color: var(--text-muted); text-transform: uppercase; font-weight: 700; margin-bottom: 10px; text-align: center; }
        canvas { width: 100%; height: 200px; display: block; }

        /* --- INPUT SECTION --- */
        .input-card {
            background-color: var(--card-bg);
            border: 3px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .greeting-label { font-size: 1.1rem; font-weight: 700; color: var(--text-main); }

        .form-row { display: flex; gap: 10px; }
        input[type="text"], input[type="number"] { padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background-color: var(--input-bg); color: var(--text-main); font-family: var(--font-body); font-size: 1rem; outline: none; }
        input[type="text"] { flex-grow: 2; }
        input[type="number"] { width: 80px; text-align: center; }
        input:focus { border-color: var(--accent-primary); }

        .btn-primary { background-color: var(--accent-primary); color: white; padding: 12px; border-radius: 8px; font-size: 1.1rem; box-shadow: 3px 3px 0px var(--border-color); width: 100%; margin-top: 5px;}
        .btn-primary:hover { transform: translate(-1px, -1px); box-shadow: 4px 4px 0px var(--border-color); }
        .btn-primary:active { transform: translate(3px, 3px); box-shadow: none; }
        
        .btn-random { background-color: var(--accent-secondary); color: var(--text-main); padding: 10px; border-radius: 8px; font-size: 0.9rem; box-shadow: 3px 3px 0px var(--border-color); margin-top: 5px; }
        .btn-random:active { transform: translate(3px, 3px); box-shadow: none; }

        /* --- LIST SECTION --- */
        .list-header { margin-top: 10px; font-size: 1.2rem; border-bottom: 3px solid var(--border-color); display: inline-block; padding-bottom: 5px; margin-bottom: 15px; }
        .fails-list { list-style: none; display: flex; flex-direction: column; gap: 15px; padding-bottom: 20px; }
        
        .fail-item {
            background-color: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 2px 2px 0px var(--border-color);
            animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .fail-content { display: flex; flex-direction: column; gap: 4px; }
        .fail-desc { font-weight: 700; font-size: 1.05rem; }
        .fail-time { font-size: 0.8rem; color: var(--text-muted); }
        .fail-points-badge { background-color: var(--input-bg); border: 2px solid var(--border-color); border-radius: 50%; width: 45px; height: 45px; display: flex; justify-content: center; align-items: center; font-weight: bold; color: var(--danger); font-family: var(--font-heading); font-size: 1.2rem; margin-left: 10px; flex-shrink: 0; }
        
        .delete-btn { background: none; border: none; color: var(--text-muted); margin-left: 10px; font-size: 1.2rem; opacity: 0.5; }
        .delete-btn:hover { opacity: 1; color: var(--danger); }
        .icon-trash { width: 20px; height: 20px; fill: currentColor; }
        .empty-state { text-align: center; color: var(--text-muted); padding: 20px; font-style: italic; opacity: 0.7; }

        /* --- FOOTER --- */
        .app-footer {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 20px;
            opacity: 0.7;
            font-family: var(--font-heading);
            font-weight: 600;
        }

        @media (max-width: 400px) { .score-value { font-size: 3rem; } .form-row { flex-direction: column; } input[type="number"] { width: 100%; } }
    </style>
</head>
<body>

<div id="onboardingScreen" class="onboarding-screen" style="display: none;">
    <div class="onboarding-card">
        <h1>Who are you?</h1>
        <p>We need a name to attach to these disasters.</p>
        <input type="text" id="onboardingInput" placeholder="Enter your name..." autocomplete="off" style="width: 100%; margin-bottom: 15px;">
        <button id="onboardingBtn" class="btn-primary">Start Ruining Everything</button>
    </div>
</div>

<div class="app-container" id="mainApp">
    <header>
        <div class="title-block">
            <h1>Downfall Tracker</h1>
        </div>
        <button class="theme-toggle" id="themeToggleBtn">Dark Mode</button>
    </header>

    <div class="scoreboard-card">
        <div class="score-label">Today's Fucked Level</div>
        <div class="score-value" id="dailyScore">0</div>
        <div class="score-sub" id="scoreMessage">Perfectly balanced...</div>
    </div>

    <div class="chart-card">
        <div class="chart-title">The Trend of Fuck-Ups (Last 7 Days)</div>
        <canvas id="trendChart"></canvas>
    </div>

    <div class="input-card">
        <h3 id="userGreeting" class="greeting-label">Log a new fail</h3>
        
        <div class="form-row">
            <input type="text" id="failDesc" placeholder="Details (e.g., put salt in my matcha)" autocomplete="off">
            <input type="number" id="failPoints" placeholder="%" min="1" max="100">
        </div>
        <button class="btn-primary" id="addFailBtn">Commit to the Downfall</button>
        <button class="btn-random" id="randomFailBtn">I can't remember, generate one</button>
    </div>

    <div>
        <h2 class="list-header">Recent Fuck-Ups</h2>
        <ul class="fails-list" id="failsList"></ul>
        <div id="emptyState" class="empty-state">No fails recorded today. DO SOMETHING.</div>
    </div>

    <footer class="app-footer">
        At the behest of my sister, from PhonexLegend
    </footer>
</div>

<script>
    /**
     * DOWNFALL TRACKER
     */

    const STORAGE_KEY = 'downfall_data';
    const THEME_KEY = 'downfall_theme';
    const USER_KEY = 'downfall_username';
    
    let appState = {
        username: null,
        fails: [] 
    };

    const RANDOM_FAILS = [
        "Made a pitch deck with the wrong font size",
        "Forgot to treat PKNOTSERIOUS",
        "Did Not call dadu",
        "Opened Aditya Mishra's Walls of text",
        "Woke up late in the presence of Bade Papa",
        "Woke up early in the presence of Ba",
        "Left the light on in the presence of Sonu Papa",

    ];

    const els = {
        onboardingScreen: document.getElementById('onboardingScreen'),
        onboardingInput: document.getElementById('onboardingInput'),
        onboardingBtn: document.getElementById('onboardingBtn'),
        mainApp: document.getElementById('mainApp'),
        greeting: document.getElementById('userGreeting'),
        scoreDisplay: document.getElementById('dailyScore'),
        scoreMessage: document.getElementById('scoreMessage'),
        descInput: document.getElementById('failDesc'),
        pointsInput: document.getElementById('failPoints'),
        addBtn: document.getElementById('addFailBtn'),
        randomBtn: document.getElementById('randomFailBtn'),
        list: document.getElementById('failsList'),
        emptyState: document.getElementById('emptyState'),
        themeBtn: document.getElementById('themeToggleBtn'),
        chartCanvas: document.getElementById('trendChart'),
        html: document.documentElement
    };

    // --- LOGIC ---

    function loadData() {
        const storedFails = localStorage.getItem(STORAGE_KEY);
        if (storedFails) appState.fails = JSON.parse(storedFails);
        
        const storedTheme = localStorage.getItem(THEME_KEY);
        if (storedTheme) {
            els.html.setAttribute('data-theme', storedTheme);
            els.themeBtn.innerText = storedTheme === 'light' ? 'Dark Mode' : 'Light Mode';
        }

        const storedUser = localStorage.getItem(USER_KEY);
        if (storedUser) {
            appState.username = storedUser;
            showApp();
        } else {
            showOnboarding();
        }
    }

    function showOnboarding() {
        els.onboardingScreen.style.display = 'flex';
        els.mainApp.style.display = 'none';
        els.onboardingInput.focus();
    }

    function handleOnboardingSubmit() {
        const name = els.onboardingInput.value.trim();
        if(!name) return alert("We really do need a name.");
        
        appState.username = name;
        localStorage.setItem(USER_KEY, name);
        
        els.onboardingScreen.style.display = 'none';
        showApp();
    }

    function showApp() {
        els.mainApp.style.display = 'flex';
        els.greeting.innerText = `Hi ${appState.username}, How did you fuck up today?`;
        render();
        resizeChart(); 
    }

    function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(appState.fails));
    }

    function getTodayScore() {
        const today = new Date().toDateString();
        return appState.fails
            .filter(f => new Date(f.timestamp).toDateString() === today)
            .reduce((sum, f) => sum + parseInt(f.points), 0);
    }

    function getChartData() {
        const days = [];
        const scores = [];
        
        for (let i = 6; i >= 0; i--) {
            const d = new Date();
            d.setDate(d.getDate() - i);
            const dateStr = d.toDateString();
            
            days.push(d.toLocaleDateString('en-US', { weekday: 'short' }));
            
            const dailyTotal = appState.fails
                .filter(f => new Date(f.timestamp).toDateString() === dateStr)
                .reduce((sum, f) => sum + parseInt(f.points), 0);
            
            scores.push(dailyTotal);
        }
        return { labels: days, data: scores };
    }

    function getSnarkyMessage(score) {
        if (score === 0) return "Suspiciously perfect...";
        if (score < 20) return "Just a little clumsy.";
        if (score < 50) return "Rough day, huh?";
        if (score < 100) return "Total chaos mode.";
        return "Complete and utter downfall.";
    }

    // --- RENDER UI ---
    function render() {
        const score = getTodayScore();
        animateValue(els.scoreDisplay, parseInt(els.scoreDisplay.innerText), score, 500);
        els.scoreMessage.innerText = getSnarkyMessage(score);

        els.list.innerHTML = '';
        const sortedFails = [...appState.fails].sort((a, b) => b.timestamp - a.timestamp);

        if (sortedFails.length === 0) {
            els.emptyState.style.display = 'block';
        } else {
            els.emptyState.style.display = 'none';
            sortedFails.forEach(fail => {
                const li = document.createElement('li');
                li.className = 'fail-item';
                const isToday = new Date(fail.timestamp).toDateString() === new Date().toDateString();
                const dateStr = isToday ? new Date(fail.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : new Date(fail.timestamp).toLocaleDateString();

                li.innerHTML = `
                    <div class="fail-content">
                        <span class="fail-desc">${escapeHtml(fail.desc)}</span>
                        <span class="fail-time">${dateStr}</span>
                    </div>
                    <div style="display:flex; align-items:center;">
                        <div class="fail-points-badge">-${fail.points}</div>
                        <button class="delete-btn" onclick="deleteFail('${fail.id}')">
                            <svg class="icon-trash" viewBox="0 0 24 24"><path d="M3 6v18h18v-18h-18zm5 14c0 .552-.448 1-1 1s-1-.448-1-1v-10c0-.552.448-1 1-1s1 .448 1 1v10zm5 0c0 .552-.448 1-1 1s-1-.448-1-1v-10c0-.552.448-1 1-1s1 .448 1 1v10zm5 0c0 .552-.448 1-1 1s-1-.448-1-1v-10c0-.552.448-1 1-1s1 .448 1 1v10zm4-18v2h-20v-2h5.711c.9 0 1.631-1.099 1.631-2h5.316c0 .901.73 2 1.631 2h5.711z"/></svg>
                        </button>
                    </div>
                `;
                els.list.appendChild(li);
            });
        }

        renderChart();
    }

    // --- CHART LOGIC ---
    function renderChart() {
        const canvas = els.chartCanvas;
        const ctx = canvas.getContext('2d');
        const { labels, data } = getChartData();
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const padding = 30;
        const width = canvas.width;
        const height = canvas.height;
        const bottomY = height - padding;
        const leftX = padding;
        const graphWidth = width - (padding * 2);
        const graphHeight = height - (padding * 2);

        const styles = getComputedStyle(els.html);
        const lineColor = styles.getPropertyValue('--chart-line').trim();
        const gridColor = styles.getPropertyValue('--chart-grid').trim();
        const textColor = styles.getPropertyValue('--text-muted').trim();

        const maxVal = Math.max(...data, 10); 
        const stepX = graphWidth / (data.length - 1);
        
        // Grid
        ctx.strokeStyle = gridColor;
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(leftX, padding); ctx.lineTo(leftX + graphWidth, padding);
        ctx.moveTo(leftX, bottomY); ctx.lineTo(leftX + graphWidth, bottomY);
        ctx.stroke();

        // Line
        ctx.strokeStyle = lineColor;
        ctx.lineWidth = 4;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.beginPath();

        const points = data.map((val, index) => {
            const x = leftX + (index * stepX);
            const normalizedY = val / maxVal; 
            const y = bottomY - (normalizedY * graphHeight);
            return {x, y, val};
        });

        points.forEach((p, i) => {
            if(i === 0) ctx.moveTo(p.x, p.y);
            else ctx.lineTo(p.x, p.y);
        });
        ctx.stroke();

        // Dots & Labels
        ctx.fillStyle = lineColor;
        ctx.font = "12px Nunito";
        ctx.textAlign = "center";
        
        points.forEach((p, i) => {
            ctx.beginPath();
            ctx.arc(p.x, p.y, 5, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = textColor;
            ctx.fillText(labels[i], p.x, height - 10);
            
            if(p.val > 0) {
                 ctx.fillStyle = lineColor;
                 ctx.fillText(p.val, p.x, p.y - 10);
            }
        });
    }

    function resizeChart() {
        const card = document.querySelector('.chart-card');
        els.chartCanvas.width = card.clientWidth - 40; 
        els.chartCanvas.height = 200;
        renderChart();
    }

    function animateValue(obj, start, end, duration) {
        if (start === end) return;
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            obj.innerHTML = Math.floor(progress * (end - start) + start);
            if (progress < 1) window.requestAnimationFrame(step);
            else obj.innerHTML = end;
        };
        window.requestAnimationFrame(step);
    }

    function escapeHtml(text) {
        if (!text) return text;
        return text.replace(/[&<>"']/g, m => ({ '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#039;' })[m]);
    }

    // --- EVENTS ---
    function handleAddFail() {
        const desc = els.descInput.value.trim();
        const points = parseInt(els.pointsInput.value);
        if (!desc) return alert("Come on, admit what you did.");
        if (!points || points <= 0) return alert("Score must be > 0");

        appState.fails.push({
            id: Date.now().toString(36) + Math.random().toString(36).substr(2),
            desc: desc,
            points: points,
            timestamp: Date.now()
        });
        saveData();
        render();
        els.descInput.value = ''; els.pointsInput.value = ''; els.descInput.focus();
    }

    function handleRandomFail() {
        els.descInput.value = RANDOM_FAILS[Math.floor(Math.random() * RANDOM_FAILS.length)];
        els.pointsInput.value = Math.floor(Math.random() * 15) + 5;
        els.pointsInput.focus();
    }

    window.deleteFail = function(id) {
        if(confirm("Erase this shame from history?")) {
            appState.fails = appState.fails.filter(f => f.id !== id);
            saveData();
            render();
        }
    };

    function toggleTheme() {
        const next = els.html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        els.html.setAttribute('data-theme', next);
        localStorage.setItem(THEME_KEY, next);
        els.themeBtn.innerText = next === 'light' ? 'Dark Mode' : 'Light Mode';
        renderChart(); 
    }

    function init() {
        loadData();
        els.onboardingBtn.addEventListener('click', handleOnboardingSubmit);
        els.addBtn.addEventListener('click', handleAddFail);
        els.randomBtn.addEventListener('click', handleRandomFail);
        els.themeBtn.addEventListener('click', toggleTheme);
        
        els.onboardingInput.addEventListener('keypress', (e) => { if(e.key==='Enter') handleOnboardingSubmit(); });
        els.descInput.addEventListener('keypress', (e) => { if(e.key==='Enter') els.pointsInput.focus(); });
        els.pointsInput.addEventListener('keypress', (e) => { if(e.key==='Enter') handleAddFail(); });

        window.addEventListener('resize', resizeChart);
    }

    init();

</script>
</body>
</html>