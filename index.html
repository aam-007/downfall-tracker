<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Downfall Tracker</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Nunito:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- CSS VARIABLES & THEME CONFIG --- */
        :root {
            --font-heading: 'Fredoka', sans-serif;
            --font-body: 'Nunito', sans-serif;
            
            /* Light Theme Palette */
            --bg-color: #f4f1ea;
            --card-bg: #ffffff;
            --text-main: #2d3436;
            --text-muted: #636e72;
            --accent-primary: #6c5ce7; /* Purple */
            --accent-secondary: #00cec9; /* Teal */
            --danger: #ff7675; /* Salmon */
            --border-color: #2d3436;
            --shadow: 4px 4px 0px #2d3436;
            --input-bg: #dfe6e9;
        }

        [data-theme="dark"] {
            /* Dark Theme Palette */
            --bg-color: #2d3436;
            --card-bg: #353b48;
            --text-main: #dfe6e9;
            --text-muted: #b2bec3;
            --accent-primary: #a29bfe;
            --accent-secondary: #81ecec;
            --danger: #fab1a0;
            --border-color: #000000;
            --shadow: 4px 4px 0px #000000;
            --input-bg: #2f3640;
        }

        /* --- GLOBAL RESET & BASE STYLES --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        h1, h2, h3 {
            font-family: var(--font-heading);
        }

        button {
            cursor: pointer;
            font-family: var(--font-heading);
            border: 2px solid var(--border-color);
            outline: none;
        }

        /* --- LAYOUT CONTAINER --- */
        .app-container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* --- HEADER & SCOREBOARD --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .title-block h1 {
            font-size: 1.8rem;
            color: var(--accent-primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0px var(--border-color);
        }

        .theme-toggle {
            background: var(--card-bg);
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: bold;
            box-shadow: 2px 2px 0px var(--border-color);
            font-size: 0.9rem;
            color: var(--text-main);
        }

        .theme-toggle:active {
            transform: translate(2px, 2px);
            box-shadow: none;
        }

        .scoreboard-card {
            background-color: var(--card-bg);
            border: 3px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
            /* Slightly wobbly look */
            transform: rotate(-1deg);
        }

        .score-label {
            font-size: 1rem;
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: 700;
        }

        .score-value {
            font-size: 4rem;
            font-family: var(--font-heading);
            color: var(--danger);
            line-height: 1;
            margin: 10px 0;
        }

        .score-sub {
            font-size: 0.9rem;
            font-style: italic;
        }

        /* --- INPUT SECTION --- */
        .input-card {
            background-color: var(--card-bg);
            border: 3px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-row {
            display: flex;
            gap: 10px;
        }

        input[type="text"], input[type="number"] {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--input-bg);
            color: var(--text-main);
            font-family: var(--font-body);
            font-size: 1rem;
            outline: none;
        }

        input[type="text"] {
            flex-grow: 2;
        }
        
        input[type="number"] {
            width: 80px;
            text-align: center;
        }

        input:focus {
            border-color: var(--accent-primary);
        }

        .btn-primary {
            background-color: var(--accent-primary);
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 1.1rem;
            box-shadow: 3px 3px 0px var(--border-color);
            transition: transform 0.1s;
        }

        .btn-primary:hover {
            transform: translate(-1px, -1px);
            box-shadow: 4px 4px 0px var(--border-color);
        }

        .btn-primary:active {
            transform: translate(3px, 3px);
            box-shadow: none;
        }

        .btn-random {
            background-color: var(--accent-secondary);
            color: var(--text-main);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            box-shadow: 3px 3px 0px var(--border-color);
            margin-top: 5px;
        }

        .btn-random:active {
            transform: translate(3px, 3px);
            box-shadow: none;
        }

        /* --- LIST SECTION --- */
        .list-header {
            margin-top: 10px;
            font-size: 1.2rem;
            border-bottom: 3px solid var(--border-color);
            display: inline-block;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }

        .fails-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding-bottom: 40px;
        }

        .fail-item {
            background-color: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 2px 2px 0px var(--border-color);
            /* Animation for entry */
            animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .fail-content {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .fail-desc {
            font-weight: 700;
            font-size: 1.05rem;
        }

        .fail-time {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .fail-points-badge {
            background-color: var(--input-bg);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: var(--danger);
            font-family: var(--font-heading);
            font-size: 1.2rem;
            margin-left: 10px;
            flex-shrink: 0;
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            margin-left: 10px;
            font-size: 1.2rem;
            opacity: 0.5;
            transition: opacity 0.2s, color 0.2s;
        }

        .delete-btn:hover {
            opacity: 1;
            color: var(--danger);
        }

        /* --- SVG ICONS --- */
        .icon-trash {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* --- UTILITY --- */
        .empty-state {
            text-align: center;
            color: var(--text-muted);
            padding: 20px;
            font-style: italic;
            opacity: 0.7;
        }

        /* --- RESPONSIVE ADJUSTMENTS --- */
        @media (max-width: 400px) {
            .score-value { font-size: 3rem; }
            .form-row { flex-direction: column; }
            input[type="number"] { width: 100%; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <div class="title-block">
            <h1>Downfall Tracker</h1>
        </div>
        <button class="theme-toggle" id="themeToggleBtn">Dark Mode</button>
    </header>

    <div class="scoreboard-card">
        <div class="score-label">Today's Mess Level</div>
        <div class="score-value" id="dailyScore">0</div>
        <div class="score-sub" id="scoreMessage">Perfectly balanced... for now.</div>
    </div>

    <div class="input-card">
        <h3>Log a new Fail</h3>
        <div class="form-row">
            <input type="text" id="failDesc" placeholder="What did you mess up?" autocomplete="off">
            <input type="number" id="failPoints" placeholder="Pts" min="1" max="100">
        </div>
        <button class="btn-primary" id="addFailBtn">Commit to the Downfall</button>
        <button class="btn-random" id="randomFailBtn">I can't remember, generate one</button>
    </div>

    <div>
        <h2 class="list-header">Recent Disasters</h2>
        <ul class="fails-list" id="failsList">
            </ul>
        <div id="emptyState" class="empty-state">No fails recorded today. Suspiciously clean.</div>
    </div>
</div>

<script>
    /**
     * DOWNFALL TRACKER
     * A modular Vanilla JS implementation.
     */

    // --- CONFIG & STATE ---
    const STORAGE_KEY = 'downfall_tracker_data';
    const THEME_KEY = 'downfall_theme';
    
    // State object
    let appState = {
        fails: [] // Array of objects: { id, desc, points, timestamp }
    };

    // Random Fails Library
    const RANDOM_FAILS = [
        "Pushed a pull door in public",
        "Replied 'You too' to the waiter",
        "Tripped over absolutely nothing",
        "Forgot why I walked into the room",
        "Sent 'attached' but didn't attach file",
        "Waved at someone who wasn't waving at me",
        "Choked on my own saliva",
        "Typed google.com into Google search",
        "Put the milk in the cupboard",
        "Plugged USB in wrong 3 times",
        "Apologized to a mannequin"
    ];

    // --- DOM ELEMENTS ---
    const els = {
        scoreDisplay: document.getElementById('dailyScore'),
        scoreMessage: document.getElementById('scoreMessage'),
        descInput: document.getElementById('failDesc'),
        pointsInput: document.getElementById('failPoints'),
        addBtn: document.getElementById('addFailBtn'),
        randomBtn: document.getElementById('randomFailBtn'),
        list: document.getElementById('failsList'),
        emptyState: document.getElementById('emptyState'),
        themeBtn: document.getElementById('themeToggleBtn'),
        html: document.documentElement
    };

    // --- CORE FUNCTIONS ---

    // 1. Storage Handling
    function loadData() {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
            appState.fails = JSON.parse(stored);
        }
        
        const storedTheme = localStorage.getItem(THEME_KEY);
        if (storedTheme) {
            els.html.setAttribute('data-theme', storedTheme);
            updateThemeBtnText(storedTheme);
        }
    }

    function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(appState.fails));
    }

    // 2. Logic & Calculations
    function getTodayScore() {
        const today = new Date().toDateString();
        return appState.fails
            .filter(f => new Date(f.timestamp).toDateString() === today)
            .reduce((sum, f) => sum + parseInt(f.points), 0);
    }

    function generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    function getSnarkyMessage(score) {
        if (score === 0) return "Suspiciously perfect...";
        if (score < 20) return "Just a little clumsy.";
        if (score < 50) return "Rough day, huh?";
        if (score < 100) return "Total chaos mode.";
        return "Complete and utter downfall.";
    }

    // 3. UI Rendering
    function render() {
        // Calculate Score
        const score = getTodayScore();
        
        // Animate Score Counter
        animateValue(els.scoreDisplay, parseInt(els.scoreDisplay.innerText), score, 500);
        els.scoreMessage.innerText = getSnarkyMessage(score);

        // Render List
        els.list.innerHTML = '';
        
        // Sort by newest first
        const sortedFails = [...appState.fails].sort((a, b) => b.timestamp - a.timestamp);

        if (sortedFails.length === 0) {
            els.emptyState.style.display = 'block';
        } else {
            els.emptyState.style.display = 'none';
            sortedFails.forEach(fail => {
                const li = document.createElement('li');
                li.className = 'fail-item';
                
                // Format time
                const dateOpts = { hour: '2-digit', minute: '2-digit' };
                const timeStr = new Date(fail.timestamp).toLocaleTimeString([], dateOpts);
                const isToday = new Date(fail.timestamp).toDateString() === new Date().toDateString();
                const dateStr = isToday ? 'Today' : new Date(fail.timestamp).toLocaleDateString();

                li.innerHTML = `
                    <div class="fail-content">
                        <span class="fail-desc">${escapeHtml(fail.desc)}</span>
                        <span class="fail-time">${dateStr}, ${timeStr}</span>
                    </div>
                    <div style="display:flex; align-items:center;">
                        <div class="fail-points-badge">-${fail.points}</div>
                        <button class="delete-btn" onclick="deleteFail('${fail.id}')" aria-label="Delete">
                            <svg class="icon-trash" viewBox="0 0 24 24"><path d="M3 6v18h18v-18h-18zm5 14c0 .552-.448 1-1 1s-1-.448-1-1v-10c0-.552.448-1 1-1s1 .448 1 1v10zm5 0c0 .552-.448 1-1 1s-1-.448-1-1v-10c0-.552.448-1 1-1s1 .448 1 1v10zm5 0c0 .552-.448 1-1 1s-1-.448-1-1v-10c0-.552.448-1 1-1s1 .448 1 1v10zm4-18v2h-20v-2h5.711c.9 0 1.631-1.099 1.631-2h5.316c0 .901.73 2 1.631 2h5.711z"/></svg>
                        </button>
                    </div>
                `;
                els.list.appendChild(li);
            });
        }
    }

    // Helper: Number Animation
    function animateValue(obj, start, end, duration) {
        if (start === end) return;
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            obj.innerHTML = Math.floor(progress * (end - start) + start);
            if (progress < 1) {
                window.requestAnimationFrame(step);
            } else {
                obj.innerHTML = end;
            }
        };
        window.requestAnimationFrame(step);
    }

    // Helper: Security (XSS prevention)
    function escapeHtml(text) {
        if (!text) return text;
        return text.replace(/[&<>"']/g, function(m) {
            return {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            }[m];
        });
    }

    // 4. Interaction Handlers
    function handleAddFail() {
        const desc = els.descInput.value.trim();
        const points = parseInt(els.pointsInput.value);

        if (!desc) {
            alert("Come on, admit what you did.");
            return;
        }
        if (!points || points <= 0) {
            alert("Give it a score greater than 0.");
            return;
        }

        const newFail = {
            id: generateId(),
            desc: desc,
            points: points,
            timestamp: Date.now()
        };

        appState.fails.push(newFail);
        saveData();
        render();

        // Clear inputs
        els.descInput.value = '';
        els.pointsInput.value = '';
        els.descInput.focus();
    }

    function handleRandomFail() {
        const randomDesc = RANDOM_FAILS[Math.floor(Math.random() * RANDOM_FAILS.length)];
        const randomPoints = Math.floor(Math.random() * 15) + 5; // 5 to 20 points
        
        els.descInput.value = randomDesc;
        els.pointsInput.value = randomPoints;
        
        // Optional: Auto submit? No, let user confirm/edit
        els.pointsInput.focus();
    }

    // Exposed globally for the HTML onclick attribute
    window.deleteFail = function(id) {
        if(confirm("Erase this shame from history?")) {
            appState.fails = appState.fails.filter(f => f.id !== id);
            saveData();
            render();
        }
    };

    function toggleTheme() {
        const current = els.html.getAttribute('data-theme');
        const next = current === 'light' ? 'dark' : 'light';
        
        els.html.setAttribute('data-theme', next);
        localStorage.setItem(THEME_KEY, next);
        updateThemeBtnText(next);
    }

    function updateThemeBtnText(theme) {
        els.themeBtn.innerText = theme === 'light' ? 'Dark Mode' : 'Light Mode';
    }

    // --- INITIALIZATION ---
    function init() {
        loadData();
        render();
        
        // Event Listeners
        els.addBtn.addEventListener('click', handleAddFail);
        els.randomBtn.addEventListener('click', handleRandomFail);
        els.themeBtn.addEventListener('click', toggleTheme);
        
        // Allow "Enter" key in inputs
        els.descInput.addEventListener('keypress', (e) => {
            if(e.key === 'Enter') els.pointsInput.focus();
        });
        els.pointsInput.addEventListener('keypress', (e) => {
            if(e.key === 'Enter') handleAddFail();
        });
    }

    // Run
    init();

</script>
</body>
</html>